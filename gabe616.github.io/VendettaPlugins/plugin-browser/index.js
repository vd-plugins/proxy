(function(I,N,g,t,_,T,s,R,p,U,v){"use strict";const{TextStyleSheet:G}=g.findByProps("TextStyleSheet"),{View:te,Text:M}=R.General;var C;(function(e){function c(a){let{children:o}=a;return React.createElement(M,{style:G["text-md/bold"]},o)}e.Bold=c})(C||(C={}));function A(e){let{onPress:c,icon:a,style:o,destructive:f}=e;const l=t.stylesheet.createThemedStyleSheet({headerStyleIcon:{marginRight:10,tintColor:p.semanticColors.HEADER_PRIMARY},cardStyleIcon:{width:22,height:22,marginLeft:5,tintColor:p.semanticColors.INTERACTIVE_NORMAL},destructiveIcon:{tintColor:p.semanticColors.TEXT_DANGER}});return React.createElement(t.ReactNative.TouchableOpacity,{onPress:c},React.createElement(t.ReactNative.Image,{style:[o==="header"?l.headerStyleIcon:l.cardStyleIcon,f&&l.destructiveIcon].filter(function(S){return!!S}),source:a}))}const{FormRow:b}=R.Forms,m=t.stylesheet.createThemedStyleSheet({card:{backgroundColor:p.semanticColors.BACKGROUND_SECONDARY,borderRadius:5},header:{padding:0,backgroundColor:p.semanticColors.BACKGROUND_TERTIARY,borderTopLeftRadius:5,borderTopRightRadius:5},actions:{flexDirection:"row-reverse",alignItems:"center"}});function V(e){const[,c]=t.React.useReducer(function(a){return~a},0);return t.React.createElement(t.ReactNative.View,{style:[m.card,{marginBottom:10}]},t.React.createElement(b,{style:m.header,label:e.headerLabel,leading:e.headerIcon&&t.React.createElement(b.Icon,{source:e.headerIcon})}),t.React.createElement(b,{label:e.descriptionLabel,trailing:t.React.createElement(t.ReactNative.View,{style:m.actions},e.actions?.().map(function(a){let{icon:o,onPress:f,destructive:l}=a;return t.React.createElement(A,{icon:o,onPress:function(){f(function(){return c()})},style:"card",destructive:l??!1})}))}))}const{showSimpleActionSheet:k}=g.findByProps("showSimpleActionSheet"),{TextStyleSheet:x}=g.findByProps("TextStyleSheet"),D=t.stylesheet.createThemedStyleSheet({text:{...x["text-md/medium"],color:p.semanticColors.TEXT_NORMAL},link:{...x["text-md/bold"],color:p.semanticColors.TEXT_LINK}}),{Text:L,View:j}=R.General;var u;(function(e){e.Newest="Newest",e.Oldest="Oldest",e.Alphabetical="Alphabetical",e.ReverseAlphabetical="Reverse Alphabetical"})(u||(u={}));function H(){const e={},[c,a]=t.React.useState(!1),[o,f]=t.React.useState(u.Newest),[l,S]=t.React.useState({}),[h,w]=t.React.useState("");t.React.useEffect(function(){w(""),f(u.Newest)},[]);const E=t.NavigationNative.useNavigation();if(!l.parsed&&!c&&(a(!0),T.safeFetch("https://vd-plugins.github.io/proxy/plugins-full.json",{cache:"no-store"}).then(function(r){return r.json()}).then(function(r){S({parsed:r}),a(!1)})),E.setOptions({title:"Plugin Browser",headerRight:function(){return t.React.createElement(j,{style:{flexDirection:"row-reverse"}},t.React.createElement(A,{onPress:function(){return!c&&S({parsed:void 0})},icon:s.getAssetIDByName("ic_sync_24px"),style:"header"}),t.React.createElement(A,{onPress:function(){return!c&&k({key:"CardOverflow",options:Object.values(u).map(function(r){return{label:r,onPress:function(){return f(r)}}})})},icon:s.getAssetIDByName("ic_filter"),style:"header"}))}}),c||!l.parsed)return t.React.createElement(t.ReactNative.ActivityIndicator,{size:"large",style:{flex:1}});let y=l.parsed.filter(function(r){return r.name?.toLowerCase().includes(h)||r.authors?.some(function(n){return n.name?.toLowerCase().includes(h)})||r.description?.toLowerCase().includes(h)});return[u.Alphabetical,u.ReverseAlphabetical].includes(o)&&(y=y.sort(function(r,n){return r.name<n.name?-1:r.name>n.name?1:0})),[u.ReverseAlphabetical,u.Newest].includes(o)&&y.reverse(),t.React.createElement(t.ReactNative.FlatList,{ListHeaderComponent:t.React.createElement(R.Search,{style:{marginBottom:10},onChangeText:function(r){return w(r.toLowerCase())}}),style:{paddingHorizontal:10,paddingTop:10},contentContainerStyle:{paddingBottom:20},data:y,renderItem:function(r){let{item:n,index:Z}=r;return t.React.createElement(V,{index:Z,headerLabel:t.React.createElement(L,{style:D.text},n.name,n.authors[0]&&" by ",...n.authors.map(function(i,P,d){return t.React.createElement(t.React.Fragment,null,t.React.createElement(L,{onPress:function(){return F(i.id)},style:D.link},i.name),P!==d.length-1&&", ")})),headerIcon:s.getAssetIDByName(n.vendetta.icon),descriptionLabel:n.description,actions:function(){const i=`https://vd-plugins.github.io/proxy/${n.vendetta.original}`,P=U.plugins.plugins[i];return P?[P.manifest.hash!==n.hash&&{icon:s.getAssetIDByName("ic_sync_24px"),onPress:async function(d){if(!e[i]){e[i]=!0;try{await O(i),v.showToast(`Successfully updated ${n.name}.`,s.getAssetIDByName("ic_sync_24px"))}catch{v.showToast(`Failed to update ${n.name}!`,s.getAssetIDByName("Small"))}delete e[i],d()}}},{icon:s.getAssetIDByName("ic_message_delete"),destructive:!0,onPress:async function(d){if(!e[i]){e[i]=!0;try{N.removePlugin(i),v.showToast(`Successfully deleted ${n.name}.`,s.getAssetIDByName("ic_message_delete"))}catch{v.showToast(`Failed to delete ${n.name}!`,s.getAssetIDByName("Small"))}delete e[i],d()}}}].filter(function(d){return!!d}):[{icon:s.getAssetIDByName("ic_download_24px"),onPress:async function(d){if(!e[i]){e[i]=!0;try{await N.installPlugin(i),v.showToast(`Successfully installed ${n.name}.`,s.getAssetIDByName("toast_image_saved"))}catch(ee){v.showToast(ee?.message??`Failed to install ${n.name}!`,s.getAssetIDByName("Small"))}delete e[i],d()}}}]}})}})}const{FormRow:B}=R.Forms;function z(){const e=t.NavigationNative.useNavigation();return React.createElement(R.ErrorBoundary,null,React.createElement(B,{label:"Plugin Browser",leading:React.createElement(B.Icon,{source:s.getAssetIDByName("ic_search_items_24px")}),trailing:B.Arrow,onPress:function(){return e.push("VendettaCustomPage",{render:H})}}))}const{FormSection:K}=R.Forms,X=g.findByName("UserSettingsOverviewWrapper",!1);function Y(){let e=[],c=_.after("default",X,function(a,o){c();const f=T.findInReactTree(o.props.children,function(l){return l.type&&l.type.name==="UserSettingsOverview"});e.push(_.after("render",f.type.prototype,function(l,S){let{props:{children:h}}=S;const w=[t.i18n.Messages.BILLING_SETTINGS,t.i18n.Messages.PREMIUM_SETTINGS];h=T.findInReactTree(h,function(y){return y.children[1].type===K}).children;const E=h.findIndex(function(y){return w.includes(y?.props.label)});h.splice(E===-1?4:E,0,React.createElement(z,null))}))},!0);return function(){return e.forEach(function(a){return a()})}}const W=g.findByStoreName("UserStore"),{showUserProfile:q}=g.findByProps("showUserProfile"),{fetchProfile:J}=g.findByProps("fetchProfile");async function O(e){const c=e.enabled;for(let a=0;a<2;a++)c&&N.stopPlugin(e.id,!1),await N.fetchPlugin(e.id),c&&await N.startPlugin(e.id)}async function F(e){W.getUser(e)||await J(e),q({userId:e})}let $;var Q={onLoad:function(){return $=Y()},onUnload:function(){return $?.()}};return I.default=Q,I.openProfile=F,I.refetchPlugin=O,Object.defineProperty(I,"__esModule",{value:!0}),I})({},vendetta.plugins,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.utils,vendetta.ui.assets,vendetta.ui.components,vendetta.ui,vendetta,vendetta.ui.toasts);
